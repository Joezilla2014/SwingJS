<project name="swingjs" default="createApps" basedir=".">
   			
<!-- buildSite.xml for building site/ -->
	
	
  <target name="createApps" id="createApps">

  	<property name="project.path" value="." />

  	<!-- create a NON svn local directory only containing JS files  -->
  	
  	<echo>deleting site/tmp directory</echo>
   	 	<delete quiet="true" dir="site/tmp" />
  	
 	
<!--  	working here -->

   	<echo>...adding html files</echo>
   	<copy todir="site/swingjs" overwrite="true" >
  	  <fileset dir="html">
  	    <include name="**/*" />
  	  </fileset>
    </copy>

    <echo>...copying all other bin/*.js to j2s</echo>
  	<copy todir="site/tmp"  overwrite="true" >
      <fileset dir="bin">
        <include name="com/**/*.js" />
        <include name="org/**/*.js" />
        <include name="test/**/*.js" />
        <exclude name="**/java/*.js" />
        <exclude name="jsjava/*.js" />
        <exclude name="jssun/*.js" />
      </fileset>
    </copy>
   	
  	<echo>...adding to swingjs/j2s non-js files from src (for CalendarData, swingjs.jquery)</echo>
  	<copy todir="site/swingjs/j2s"  overwrite="true" >
      <fileset dir="src">
        <include name="**/*.properties" />
        <include name="**/*.css" />
        <include name="**/*.png" />
        <include name="**/*.txt" />
      </fileset>
    </copy>
   	
<!--  	
  	<echo>...adding Falstad filesto swingjs/j2s property and css files from src (for CalendarData, swingjs.jquery)</echo>
  	<copy todir="site/swingjs/j2s"  overwrite="true" >
      <fileset dir="src">
        <include name="**/*.properties" />
        <include name="**/*.css" />
        <include name="**/*.png" />
        <include name="**/*.txt" />
      </fileset>
    </copy>
   	
-->
   	<echo>Fixing "jsjava" references</echo>
  	<replace dir="site/tmp" includes="**/*.*" token="jsjava" value="java" />
  	<replace dir="site/tmp" includes="**/*.js" token="javajs.util" value="JU" />
  		
  	<!-- modify class names -->		

    <echo>removing j2s globals Class and JavaObject</echo>
    <echo>...replacing Class.forName with Clazz._4Name</echo>
  	<replace dir="site/tmp" includes="**/*.js" token="Class.forName" value="Clazz._4Name"/>
    <echo>...replacing JavaObject with Clazz._O</echo>
  	<replace dir="site/tmp" includes="**/*.js" token=" JavaObject" value=" Clazz._O"/>
    <echo>...removing all $fz references for sub/superclass common private function names</echo>
  	<replace dir="site/tmp" includes="**/*.js" token="($fz =" value=""/>
  	<replace dir="site/tmp" includes="**/*.js" token=", $fz.isPrivate = true, $fz)" value=""/>
  	<echo>...changing Clazz.pu$h() to Clazz.pu$h(self.c$) (only a partial fix)</echo>
  	<replace dir="site/tmp" includes="**/*.js" token="Clazz.pu$h()" value="Clazz.pu$h(self.c$)"/>
  	<replace dir="site/tmp" includes="**/*.js" token="Clazz.pu$h ()" value="Clazz.pu$h(self.c$)"/>
   	   	

    <echo>...abbreviating class name "javajs.util", and "com.jcraft.jzlib" to "JU"</echo>
  	<replace dir="site/tmp" includes="**/*.js" token="javajs.util" value="JU"/>
  	<replace dir="site/tmp" includes="**/*.js" token="com.jcraft.jzlib" value="JU"/>
   	  	   	  	
   	<echo>Fixing J2S compiler errors</echo>
    <echo>...replacing "new Boolean" with "Boolean.from" in com, org, and test</echo>
  	<replace dir="site/tmp/org" includes="**/*.js" token="new Boolean" value="Boolean.from"/>
  	<replace dir="site/tmp/com" includes="**/*.js" token="new Boolean" value="Boolean.from"/>
  	<replace dir="site/tmp/test" includes="**/*.js" token="new Boolean" value="Boolean.from"/>
   	
  	<copy todir="site/swingjs/j2s"  overwrite="true" >
      <fileset dir="site/tmp">
        <include name="**/*.js" />
      </fileset>
    </copy>

  	<echo>deleting site/tmp directory</echo>
   	 	<delete quiet="true" dir="site/tmp" />
  	

  </target>
	
  </project>
